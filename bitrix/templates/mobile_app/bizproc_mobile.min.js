if(typeof BX.BizProcMobile==="undefined"){BX.BizProcMobile={};BX.BizProcMobile.doTask=function(e,a,t){e["sessid"]=BX.bitrix_sessid();app.showPopupLoader({text:"..."});BX.ajax({method:"POST",dataType:"json",url:(BX.message("MobileSiteDir")?BX.message("MobileSiteDir"):"/")+"mobile/?mobile_action=bp_do_task",data:e,onsuccess:function(i){app.hidePopupLoader();if(i.ERROR){app.alert({text:i.ERROR,title:BX.message("MB_BP_DETAIL_ALERT")})}else{if(a)a(i,e);if(!t)BXMobileApp.onCustomEvent("bpDoTaskComplete",e,true)}},onfailure:function(){app.hidePopupLoader();app.reload()}});return false};BX.BizProcMobile.openTaskPage=function(e,a){if(typeof a!="undefined"&&a!=null&&a&&typeof a.target!="undefined"&&a.target!=null){if(typeof a.target.tagName!="undefined"&&a.target.tagName.toLowerCase()=="a"){return false}var t=BX.findParent(a.target,{tag:"A"},{tag:"div",className:"post-item-post-block"});if(t&&!BX.hasClass(t,"webform-small-button-blue")){return false}}app.loadPageBlank({url:(BX.message("MobileSiteDir")?BX.message("MobileSiteDir"):"/")+"mobile/bp/detail.php?task_id="+e,unique:true});return false};BX.BizProcMobile.renderLogMessage=function(e,a,t){if(!e)return false;if(a!==null){var i=e.parentNode;if(!i)return false;i.innerHTML=a;e=i.querySelector('[data-role="mobile-log-bp-wf"]');if(!e)return false}var r=JSON.parse(e.getAttribute("data-tasks")),o=0,s="0",l="1",n="2",f="3",u="4",d=false,p=false;if(BX.message("USER_ID"))o=BX.message("USER_ID");var B=function(e,a){for(var t=0,i=e.USERS.length;t<i;++t){if(e.USERS[t]["USER_ID"]==a)return e.USERS[t]}return null};if(r.length){for(var c=0,b=r.length;c<b;++c){var g=r[c];var m=B(g,o);if(m){if(m.STATUS>s)d=m.STATUS;else{d=false;p=g.ID;var _=BX.findChild(e,{className:"task_buttons_"+g.ID},true);if(_)_.style.display="";var X=BX.findChild(e,{className:"task_block_"+g.ID},true);if(X)X.style.display="";break}}}}if(d!==false){var v="user_status_ok";if(d==l)v="user_status_yes";else if(d==n||d==u)v="user_status_no";var M=BX.findChild(e,{className:v},true);if(M)M.style.display=""}var D=BX.findChild(e,{className:"wf_status"},true);if(D)D.style.display=d||p?"none":"";e.setAttribute("data-rendered",t)};BX.BizProcMobile.renderLogMessages=function(e,a,t,i){var r=e.querySelectorAll('[data-role="mobile-log-bp-wf"]');if(!i)i="Y";if(r){for(var o=0;o<r.length;o++){var s=r[o].getAttribute("data-rendered"),l=r[o].getAttribute("data-workflow-id");if(s){if(s===i.toString())continue;if(a&&a!==l)continue}var n=a===l?t:null;BX.BizProcMobile.renderLogMessage(r[o],n,i)}}};BX.BizProcMobile.loadLogMessageCallback=function(e,a){BX.ajax({method:"POST",dataType:"html",url:"/mobile/?mobile_action=bp_livefeed_action",data:{WORKFLOW_ID:a["WORKFLOW_ID"]},onsuccess:function(e){a["NEW_LOG_CONTENT"]=e;a["UPDATE_ID"]=parseInt(Math.random()*1e4);BX.BizProcMobile.renderLogMessages(document,a["WORKFLOW_ID"],e,a["UPDATE_ID"]);BXMobileApp.onCustomEvent("bpDoTaskComplete",a,true)}})};BX.BizProcMobile.renderFacePhoto=function(e,a){var t=BX.message("USER_ID"),i=a[0];if(t&&a.length>1){for(var r=0,o=a.length;r<o;++r){var s=a[r];if(s["USER_ID"]==t){i=s;break}}}if(i["PHOTO_SRC"]){e.src=i["PHOTO_SRC"]}};BX.BizProcMobile.showDatePicker=function(e,a){var t="M/d/y H:m";var i=e.parentNode;var r=BX.findChild(i,{tag:"input"});var o=r.getAttribute("data-type")==="date"?"date":"datetime";var s={type:o,format:t,callback:function(a){var t=new Date(Date.parse(a));var i=o==="date"?BX.message("FORMAT_DATE"):BX.message("FORMAT_DATETIME");var s=BX.formatDate(t,i);r.value=s;e.innerHTML=s}};BXMobileApp.UI.DatePicker.setParams(s);BXMobileApp.UI.DatePicker.show();return BX.PreventDefault(a)}}
//# sourceMappingURL=bizproc_mobile.map.js
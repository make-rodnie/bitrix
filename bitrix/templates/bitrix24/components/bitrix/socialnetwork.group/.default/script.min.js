(function(){if(window["B24SGControl"])return;window.B24SGControl=function(){this.instance=null;this.groupId=null;this.waitPopup=null;this.waitTimeout=null;this.notifyHintPopup=null;this.notifyHintTimeout=null;this.notifyHintTime=3e3;this.favoritesValue=null;this.newValue=null;this.menuItem=null};window.B24SGControl.getInstance=function(){if(window.B24SGControl.instance==null){window.B24SGControl.instance=new B24SGControl}return window.B24SGControl.instance};window.B24SGControl.prototype={init:function(e){if(typeof e=="undefined"||typeof e.groupId=="undefined"||parseInt(e.groupId)<=0){return}this.groupId=parseInt(e.groupId);this.favoritesValue=!!e.favoritesValue;BX.addCustomEvent("BX.Bitrix24.LeftMenuClass:onMenuItemAdded",BX.delegate(function(){this.favoritesValue=true;this.setMenuItemTitle(true)},this));BX.addCustomEvent("BX.Bitrix24.LeftMenuClass:onMenuItemDeleted",BX.delegate(function(){this.favoritesValue=false;this.setMenuItemTitle(false)},this))},setSubscribe:function(e){var t=this;t.showWait();var i=!BX.hasClass(BX("group_menu_subscribe_button"),"webform-button-active")?"set":"unset";BX.ajax({url:"/bitrix/components/bitrix/socialnetwork.group_menu/ajax.php",method:"POST",dataType:"json",data:{groupID:t.groupId,action:i=="set"?"set":"unset",sessid:BX.bitrix_sessid()},onsuccess:function(e){t.processSubscribeAJAXResponse(e)}});BX.PreventDefault(e)},setFavorites:function(e){var t=this;t.showWait();t.newValue=!t.favoritesValue;t.setMenuItemTitle(t.newValue);BX.ajax({url:"/bitrix/components/bitrix/socialnetwork.group_menu/ajax.php",method:"POST",dataType:"json",data:{groupID:t.groupId,action:t.favoritesValue?"fav_unset":"fav_set",sessid:BX.bitrix_sessid(),lang:BX.message("LANGUAGE_ID")},onsuccess:function(e){t.processFavoritesAJAXResponse(e);if(typeof e.NAME!="undefined"&&typeof e.URL!="undefined"){BX.onCustomEvent(window,"BX.Socialnetwork.WorkgroupFavorites:onSet",[{id:t.groupId,name:e.NAME,url:e.URL,extranet:typeof e.EXTRANET!="undefined"?e.EXTRANET:"N"},t.newValue])}},onfailure:function(e){t.setMenuItemTitle(t.favoritesValue)}});BX.PreventDefault(e)},setMenuItemTitle:function(e){if(this.menuItem){BX(this.menuItem).innerHTML=BX.message(!!e?"SGMFavoritesTitleN":"SGMFavoritesTitleY")}},processSubscribeAJAXResponse:function(e){var t=this;if(typeof e["SUCCESS"]!="undefined"&&e["SUCCESS"]=="Y"){t.closeWait();var i=BX("group_menu_subscribe_button",true);if(i){if(typeof e["RESULT"]!="undefined"&&e["RESULT"]=="N"){t.showNotifyHint(i,BX.message("SGMSubscribeButtonHintOff"));BX.adjust(i,{attrs:{title:BX.message("SGMSubscribeButtonTitleOff")}});BX.removeClass(i,"webform-button-active")}else{t.showNotifyHint(i,BX.message("SGMSubscribeButtonHintOn"));BX.adjust(i,{attrs:{title:BX.message("SGMSubscribeButtonTitleOn")}});BX.addClass(i,"webform-button-active")}}return false}else if(typeof e["ERROR"]!="undefined"&&e["ERROR"].length>0){t.processAJAXError(e["ERROR"]);return false}},processFavoritesAJAXResponse:function(e){var t=this;t.closeWait();if(typeof e["SUCCESS"]!="undefined"&&e["SUCCESS"]=="Y"){t.favoritesValue=t.newValue}else if(typeof e["ERROR"]!="undefined"&&e["ERROR"].length>0){t.processAJAXError(e["ERROR"])}t.setMenuItemTitle(t.favoritesValue);return false},processAJAXError:function(e){var t=this;if(e.indexOf("SESSION_ERROR",0)===0){t.showError(BX.message("SGMErrorSessionWrong"));return false}else if(e.indexOf("CURRENT_USER_NOT_AUTH",0)===0){t.showError(BX.message("SGMErrorCurrentUserNotAuthorized"));return false}else if(e.indexOf("SONET_MODULE_NOT_INSTALLED",0)===0){t.showError(BX.message("SGMErrorModuleNotInstalled"));return false}else{t.showError(e);return false}},showWait:function(e){var t=this;if(e!==0){return t.waitTimeout=setTimeout(function(){t.showWait(0)},300)}if(!t.waitPopup){t.waitPopup=new BX.PopupWindow("sgm_wait",window,{autoHide:true,lightShadow:true,zIndex:2,content:BX.create("DIV",{props:{className:"sonet-sgm-wait-cont"},children:[BX.create("DIV",{props:{className:"sonet-sgm-wait-icon"}}),BX.create("DIV",{props:{className:"sonet-sgm-wait-text"},html:BX.message("SGMWaitTitle")})]})})}else{t.waitPopup.setBindElement(window)}t.waitPopup.show()},closeWait:function(){if(this.waitTimeout){clearTimeout(this.waitTimeout);this.waitTimeout=null}if(this.waitPopup){this.waitPopup.close()}},showNotifyHint:function(e,t){var i=this;if(i.notifyHintTimeout){clearTimeout(i.notifyHintTimeout);i.notifyHintTimeout=null}if(i.notifyHintPopup==null){i.notifyHintPopup=new BX.PopupWindow("sgm_notify_hint",e,{autoHide:true,lightShadow:true,zIndex:2,content:BX.create("DIV",{props:{className:"sonet-sgm-notify-hint-content"},style:{display:"none"},children:[BX.create("SPAN",{props:{id:"sgm_notify_hint_text"},html:t})]}),closeByEsc:true,closeIcon:false,offsetLeft:10});i.notifyHintPopup.TEXT=BX("sgm_notify_hint_text");i.notifyHintPopup.setBindElement(e)}else{i.notifyHintPopup.TEXT.innerHTML=t;i.notifyHintPopup.setBindElement(e)}i.notifyHintPopup.setAngle({});i.notifyHintPopup.show();i.notifyHintTimeout=setTimeout(function(){i.notifyHintPopup.close()},i.notifyHintTime)},showError:function(e){this.closeWait();var t=new BX.PopupWindow("sgm-error"+Math.random(),window,{autoHide:true,lightShadow:false,zIndex:2,content:BX.create("DIV",{props:{className:"sonet-sgm-error-text-block"},html:e}),closeByEsc:true,closeIcon:true});t.show()}};window.BX.SGMSetSubscribe=window.B24SGControl.getInstance().setSubscribe})();
//# sourceMappingURL=script.map.js